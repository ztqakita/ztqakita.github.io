<!doctype html><html><head><title>Mass-Storage Structure & I/O System</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png><link rel=stylesheet href=/css/style.css><meta name=description content="Mass-Storage Structure & I/O System"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png>ztqakita's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png class=d-none id=main-logo>
<img src=/images/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=https://ztqakita.github.io/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/introduction/>Introduction</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/algorithms/>Algorithms</a><ul><li><a href=/posts/algorithms/algorithm_analysis-1/>Complexity & Divide and Conquer</a></li><li><a href=/posts/algorithms/algorithm_analysis-2/>Dynamic Programming</a></li><li><a href=/posts/algorithms/algorithm_analysis-3/>Greedy & Back-track & Branch and Bound</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/compiler/>Compiler</a><ul><li><a href=/posts/compiler/compilers_1/>Lexcial Analysis & Parsing</a></li><li><a href=/posts/compiler/compilers_3/>Semantic Analysis & Runtime Environment</a></li><li><a href=/posts/compiler/compilers_2/>Syntax-directed Translation</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/neural-computation/>Computational Neuroscience</a><ul><li><a href=/posts/neural-computation/1-ionic_currents/>Ionic Currents</a></li><li><a href=/posts/neural-computation/basic-neuro-knowledge/>Neuroscience Basic Knowledge</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/database-system/>Database System</a><ul><li><a href=/posts/database-system/database_system_1/>Database System Lecture Note 1</a></li><li><a href=/posts/database-system/database_system_2/>Database System Lecture Note 2</a></li><li><a href=/posts/database-system/database_system_3/>Database System Lecture Note 3</a></li><li><a href=/posts/database-system/database_system_4/>Database System Lecture Note 4</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/deep-learning/>DL</a><ul><li><a href=/posts/deep-learning/cnn/>Convolutional Neural Network</a></li><li><a href=/posts/deep-learning/introduction-to-deep-learning/>Introduction to Deep Learning</a></li><li><a href=/posts/deep-learning/optimizer-for-dl/>Optimization for Deep Learning</a></li><li><a href=/posts/deep-learning/rnn/>Recursive Neural Network</a></li><li><a href=/posts/deep-learning/self-attention/>Self-attention</a></li><li><a href=/posts/deep-learning/transformer/>Transformer</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/life-learning/>Life Learning</a><ul><li><a href=/posts/life-learning/architectures_of_neuronal_circuits/>Architectures of neuronal circuits</a></li><li><a href=/posts/life-learning/how_to_model/>how to model</a></li><li><a href=/posts/life-learning/lecture_james_mcclleland/>Lecture James McClleland</a></li><li><a href=/posts/life-learning/lecture_yao_xin/>Lecture Yao Xin</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/machine-learning/>ML</a><ul><li><a href=/posts/machine-learning/basic-concepts/>Basic Concepts</a></li><li><a href=/posts/machine-learning/classification/>Classification</a></li><li><a href=/posts/machine-learning/decision-tree/>Decision Tree</a></li><li><a href=/posts/machine-learning/knn/>KNN</a></li><li><a href=/posts/machine-learning/perceptron/>Perceptron</a></li><li><a href=/posts/machine-learning/som/>SOM</a></li><li><a href=/posts/machine-learning/support-vector/>Support Vector Machines</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/operating-system/>Operating System</a><ul class=active><li><a href=/posts/operating-system/operating_system_concepts_3/>CPU Scheduling</a></li><li><a href=/posts/operating-system/operating_system_concepts_6/>File System</a></li><li><a href=/posts/operating-system/operating_system_concepts_1/>Introduction & OS Structure</a></li><li><a class=active href=/posts/operating-system/operating_system_concepts_7/>Mass-Storage Structure & I/O System</a></li><li><a href=/posts/operating-system/operating_system_concepts_5/>Memory Management</a></li><li><a href=/posts/operating-system/operating_system_concepts_2/>Process & Threads</a></li><li><a href=/posts/operating-system/operating_system_concepts_4/>Process Synchronization</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/paper-reading/>Paper Reading</a><ul><li><a href=/posts/paper-reading/continuous_attractor_nn/>Continuous-attractor Neural Network</a></li><li><a href=/posts/paper-reading/few-shot_class_incremental_learning/>Few-Shot Class-Incremental Learning</a></li><li><a href=/posts/paper-reading/integrated_understanding_system/>Integrated understanding system</a></li><li><a href=/posts/paper-reading/push-pull_feedback/>Push-pull feedback</a></li><li><a href=/posts/paper-reading/reservoir_decision_making/>reservoir decision making network</a></li><li><a href=/posts/paper-reading/task_representation_cognitive_tasks/>Task representations in neural networks</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://ztqakita.github.io/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/ztq.png><h5 class=author-name>Brandon Zhang</h5><p>December 10, 2020</p></div><div class=title><h1>Mass-Storage Structure & I/O System</h1></div><div class=post-content id=post-content><h1 id=chapter-12-mass-storage-structure>Chapter 12 Mass-Storage Structure</h1><blockquote><p>hard disk drives(HDDs) and nonvolatile memory (NVM)</p></blockquote><h2 id=121-122-disk-structure>12.1-12.2 Disk Structure</h2><p>Mapping between disk and blocks
<img src=/images/posts/OS/46.jpg alt>
并行快速读取多个连续的blocks/sectors</p><ol><li><p><strong>Transfer rate</strong>: the rate at which data flow between the driver and the computer</p></li><li><p><strong>The position time</strong>:</p><ol><li><strong>seek time</strong>: the time for the disk to move the disk arm to the cylinder containing the desired sector.平均为移动1/2*(总磁道数)所需的时间</li><li><strong>rotational latency</strong>: the time for the desired sector to rotate to the disk head. 磁盘旋转半圈所需时间(depend on RPM)</li></ol></li><li><p>外部传输速率>内部传输速率
<img src=/images/posts/OS/47.jpg alt></p></li></ol><ul><li>外部传输速率：硬盘缓存cache（磁盘控制器中的I/O寄存器）与内存间的传输速率；</li><li>内部传输速率：磁头在盘片上读写数据速率，取决于<code>Position time</code></li></ul><ol start=4><li>Drive attached to computer via I/O bus, including</li></ol><ul><li>IDE (Integrated Drive Electronics);</li><li>ATA</li><li>SATA (Serial ATA ), 适用于PC 机、服务器</li><li>mSATA</li><li>SCSI (Small Computer System Interface)，中、高端服务器和高档工作站中</li><li>Fibre Channe (光纤通道)，服务器、工作站</li><li>USB接口</li></ul><ol start=5><li><strong>Disk Controller</strong>
Interfaces between the computer system and the disk drive hardware.
Function:<ul><li>checksum</li><li>bad sector remapping</li></ul></li></ol><h2 id=124-disk-scheduling>12.4 Disk Scheduling</h2><p>having a <code>fast access time</code> and <code>disk bandwidth</code></p><ol><li><p>FCFS scheduling</p></li><li><p>SSTF scheduling
Shortest-seek-time-first</p></li><li><p>SCAN scheduling
SCAN是每一次都要到达最外圈/最内圈才转向，转向后继续扫描并读block</p><ul><li>C-SCAN schduling
C-SCAN代表当走到最内圈以后迅速移到另一头的最外圈</li></ul></li><li><p>LOOK
LOOK是电梯调度算法，每一次方向都到达request中的最大值，然后立刻转向并继续扫描读block</p><ul><li>C-LOOK代表每一次到达request中的最大值后迅速移到另一头的request最小值开始继续按原方向扫描</li></ul></li></ol><p>Note:</p><ol><li>About preventing starvation in scheduling.
<img src=/images/posts/OS/48.jpg alt></li><li>About NVM scheduling
Random access.</li></ol><h2 id=125-disk-management>12.5 Disk Management</h2><h3 id=1251-disk-formatting-格式化>12.5.1 Disk formatting (格式化)</h3><ol><li><p><strong>physical formatting</strong>:
Dividing a disk into sectors that the disk controller can read and write.
划分硬盘的磁柱面、建立扇区、选择扇区间隔比</p></li><li><p><strong>Logical formatting</strong>
making a file system on the partitions.</p></li></ol><ul><li><strong>格式化</strong>：将分区所有磁道扫描一遍，清除所有扇区内容，移除文件；扫描同时，检查磁盘是否有坏扇区；加载文件系统(exFAT、NTFS、FAT32)</li><li><strong>快速格式化</strong>：清除FAT表内容，使系统认为盘上没有文件了，并不真正格式化全部硬盘。</li></ul><p>To increase efficiency, most file systems group blocks into larger chunks, called clusters(簇)</p><h3 id=1252-boot-block>12.5.2 Boot Block</h3><blockquote><p>bootstrap -> Boot Block -> 内核程序</p></blockquote><p>The boot block initializes system</p><ul><li>the bootstrap is stored in ROM.</li><li>bootstrap loader program.</li></ul><h3 id=1253-bad-blocks>12.5.3 Bad Blocks</h3><h2 id=123-disk-attachment>12.3 Disk Attachment</h2><p>Disks may be attached via one of two ways</p><ul><li>host attached via an I/O port talking to I/O busses,
e.g. SCSI</li><li>network attached via a network connection
e.g. SAN, NAS, DAS</li></ul><h3 id=1231-network-attached-storagenas>12.3.1 Network-Attached Storage(NAS)</h3><ul><li>NFS and CIFS are common protocols</li><li>Implemented via remote procedure calls (RPCs) between host and storage</li><li>New iSCSI protocol uses IP network to carry the SCSI protocol</li></ul><h3 id=1232-storage-area-networksan>12.3.2 Storage Area network(SAN)</h3><p><img src=/images/posts/OS/49.jpg alt></p><h3 id=1233-direct-attached-storagedas>12.3.3 Direct Attached Storage(DAS)</h3><p><img src=/images/posts/OS/50.jpg alt></p><h2 id=125-raid>12.5 RAID</h2><ol><li>Def: A data storage method in which data, along with information used for error correction, such as parity bits or Hamming codes, <strong>is distributed among two or more hard disk drives in order to improve performance and reliability</strong></li><li>特点：<ol><li>可以存两个副本，用于防止数据丢失，增加可靠性；</li><li>将连续相关的数据放在相邻disk中，可以一并读取。</li><li>RAID填补了CPU速度快与磁盘设备速度慢之间的间隙</li></ol></li></ol><h2 id=126-swap-space-management>12.6 Swap-Space Management</h2><ol><li><strong>Swap-space</strong>:
a part of disk space used as an extension of main memory to implement virtual memory, as a raw partition</li></ol><h2 id=128-stable-storage-implementation>12.8 Stable-Storage Implementation</h2><p><strong>Write-ahead log</strong>：典型例子数据库的事务故障恢复log文件。
Step:</p><ol><li>Replicate information on more than one nonvolatile storage media with independent failure modes;</li><li>Update information in a controlled manner to ensure that we can <strong>recover the stable data after any failure during data transfer or recovery</strong>.</li></ol><h1 id=chapter-13-io-system>Chapter 13 I/O System</h1><p>including <em>devices, device controllers, and I/O subsystem</em></p><h2 id=131-io-hardware>13.1 I/O Hardware</h2><ol><li>device controller registers：<ul><li>status register</li><li>control register</li><li>data-in register</li><li>data-out register</li></ul></li></ol><blockquote><p>reading and writing device registers are conducted by <strong>device drivers</strong>!!!</p></blockquote><ol start=2><li><p>The processor control the device in 2 ways:</p><ul><li>direct I/O instructions</li><li><strong>memory-mapped I/O</strong>: (用访问内存的方式访问I/O设备)<ul><li>device-controller registers are mapped into address space of the CPU</li><li>CPU executes I/O requests using the standard memory instructions to access controller registers</li></ul></li></ul></li><li><p>The main control modes for data tranfer between memory/CPU and devices are:</p><ul><li>polling</li><li>interrupt</li><li>DMA</li></ul></li></ol><h2 id=132-application-io-interface>13.2 Application I/O Interface</h2><p>Linux：driver放在内核空间中，其他：driver放在用户态中（微内核）
封装I/O system calls</p><ul><li>应用接口通用性</li><li>I/O 软件的设备独立性</li></ul><p>I/O设备访问接口与文件读写类似：write(#device, block_address)</p><ol start=2><li><p>Driver</p><ul><li>由CPU执行，完成对具体I/O操作的管理和控制功能；</li><li>将函数调用read、write与driver中的文件操作函数相匹配。</li><li>Device driver向device controller的控制寄存器CSR设置读写命令和参数，controller据此完成具体I/O操作</li></ul></li><li><p>Block devices and character-stream devices
Block: read(), write(), seek();
stream: get(), put();</p></li><li><p>Network devices: socket</p></li><li><p>Blocking and Nonblocking I/O</p><ul><li>阻塞I/O</li><li>非阻塞I/O<ul><li>多线程</li><li>利用系统提供的非阻塞I/O系统调用</li><li>异步I/O系统调用：the process runs while I/O executes.</li></ul></li></ul></li></ol><h2 id=133-io-subsystem>13.3 I/O subsystem</h2><p>I/O subsystem consists of</p><ul><li>kernel I/O subsystem<ul><li>a component that conducts <em>scheduling, buffering, cacheing, and spooling, error handlinig</em></li><li>a general device-driver interface</li></ul></li><li>drivers for specific hardware devices</li></ul><p>DST：设备开关表：
对外提供的接口</p><h3 id=1331-kernel-io-subsystem>13.3.1 Kernel I/O subsystem</h3><ol><li>Scheduling</li><li>Buffering:
存储输入/输出数据<ul><li>To cope with I/O device&rsquo;s speed mismatch with that of CPU memory access. (内部速率与外部速率不匹配)</li><li>To cope with I/O device transfer size mismatch</li></ul></li></ol><blockquote><p>used for <strong>Block device</strong></p></blockquote><ol start=3><li><p>Caching
目的：做备份，提高访问速度</p></li><li><p>Spooling
类似<strong>超线程</strong>，同时进行外围操作，使得从逻辑模拟出多台共享设备，实现由串行->并发，且无需信号量。
经典例子：<strong>打印机队列</strong>
在一个物理设备上模拟出多个逻辑设备。每一个进程共享虚拟设备的存储区
daemon：调度程序。</p></li><li><p>Error Handling
Status register</p></li><li><p>I/O protection
通过系统调用间接使用I/O instruction</p></li></ol><h2 id=134-transforming-io-request-to-hardware-operations>13.4 Transforming I/O Request to Hardware Operations</h2></div><div class=btn-improve-page><a href=https://github.com/ztqakita/ztqakita.github.io/edit//content/posts/operating-system/Operating_System_Concepts_7.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/operating-system/operating_system_concepts_6/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>File System</span></a></div><div class="col-md-6 next-article"><a href=/posts/database-system/database_system_3/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Database System Lecture Note 3</span></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#121-122-disk-structure>12.1-12.2 Disk Structure</a></li><li><a href=#124-disk-scheduling>12.4 Disk Scheduling</a></li><li><a href=#125-disk-management>12.5 Disk Management</a><ul><li><a href=#1251-disk-formatting-格式化>12.5.1 Disk formatting (格式化)</a></li><li><a href=#1252-boot-block>12.5.2 Boot Block</a></li><li><a href=#1253-bad-blocks>12.5.3 Bad Blocks</a></li></ul></li><li><a href=#123-disk-attachment>12.3 Disk Attachment</a><ul><li><a href=#1231-network-attached-storagenas>12.3.1 Network-Attached Storage(NAS)</a></li><li><a href=#1232-storage-area-networksan>12.3.2 Storage Area network(SAN)</a></li><li><a href=#1233-direct-attached-storagedas>12.3.3 Direct Attached Storage(DAS)</a></li></ul></li><li><a href=#125-raid>12.5 RAID</a></li><li><a href=#126-swap-space-management>12.6 Swap-Space Management</a></li><li><a href=#128-stable-storage-implementation>12.8 Stable-Storage Implementation</a></li></ul><ul><li><a href=#131-io-hardware>13.1 I/O Hardware</a></li><li><a href=#132-application-io-interface>13.2 Application I/O Interface</a></li><li><a href=#133-io-subsystem>13.3 I/O subsystem</a><ul><li><a href=#1331-kernel-io-subsystem>13.3.1 Kernel I/O subsystem</a></li></ul></li><li><a href=#134-transforming-io-request-to-hardware-operations>13.4 Transforming I/O Request to Hardware Operations</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=#achievements>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>ztqakita@163.com</span></li><li><span>Phone:</span> <span>(+86)18618180071</span></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form><div class=form-group><input type=email class=form-control id=exampleInputEmail1 aria-describedby=emailHelp placeholder="Enter email">
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small></div><button type=submit class="btn btn-info">Submit</button></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png>
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/js/jquery-3.4.1.min.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/navbar.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:!0,processEnvironments:!0,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var b=MathJax.Hub.getAllJax(),a;for(a=0;a<b.length;a+=1)b[a].SourceElement().parentNode.className+=' has-jax'}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>
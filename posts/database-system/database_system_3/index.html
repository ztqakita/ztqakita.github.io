<!doctype html><html><head><title>Database System Lecture Note 3</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png><link rel=stylesheet href=/css/style.css><meta name=description content="Database System Lecture Note 3"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png>ztqakita's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png class=d-none id=main-logo>
<img src=/images/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=https://ztqakita.github.io/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/introduction/>Introduction</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/algorithms/>Algorithms</a><ul><li><a href=/posts/algorithms/algorithm_analysis-1/>Complexity & Divide and Conquer</a></li><li><a href=/posts/algorithms/algorithm_analysis-2/>Dynamic Programming</a></li><li><a href=/posts/algorithms/algorithm_analysis-3/>Greedy & Back-track & Branch and Bound</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/compiler/>Compiler</a><ul><li><a href=/posts/compiler/compilers_1/>Lexcial Analysis & Parsing</a></li><li><a href=/posts/compiler/compilers_3/>Semantic Analysis & Runtime Environment</a></li><li><a href=/posts/compiler/compilers_2/>Syntax-directed Translation</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/database-system/>Database System</a><ul class=active><li><a href=/posts/database-system/database_system_1/>Database System Lecture Note 1</a></li><li><a href=/posts/database-system/database_system_2/>Database System Lecture Note 2</a></li><li><a class=active href=/posts/database-system/database_system_3/>Database System Lecture Note 3</a></li><li><a href=/posts/database-system/database_system_4/>Database System Lecture Note 4</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/deep-learning/>DL</a><ul><li><a href=/posts/deep-learning/cnn/>Convolutional Neural Network</a></li><li><a href=/posts/deep-learning/introduction-to-deep-learning/>Introduction to Deep Learning</a></li><li><a href=/posts/deep-learning/optimizer-for-dl/>Optimization for Deep Learning</a></li><li><a href=/posts/deep-learning/rnn/>Recursive Neural Network</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/machine-learning/>ML</a><ul><li><a href=/posts/machine-learning/basic-concepts/>Basic Concepts</a></li><li><a href=/posts/machine-learning/classification/>Classification</a></li><li><a href=/posts/machine-learning/decision-tree/>Decision Tree</a></li><li><a href=/posts/machine-learning/perceptron/>Perceptron</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/operating-system/>Operating System</a><ul><li><a href=/posts/operating-system/operating_system_concepts_3/>CPU Scheduling</a></li><li><a href=/posts/operating-system/operating_system_concepts_6/>File System</a></li><li><a href=/posts/operating-system/operating_system_concepts_1/>Introduction & OS Structure</a></li><li><a href=/posts/operating-system/operating_system_concepts_7/>Mass-Storage Structure & I/O System</a></li><li><a href=/posts/operating-system/operating_system_concepts_5/>Memory Management</a></li><li><a href=/posts/operating-system/operating_system_concepts_2/>Process & Threads</a></li><li><a href=/posts/operating-system/operating_system_concepts_4/>Process Synchronization</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://ztqakita.github.io/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/ztq.png><h5 class=author-name>Brandon Zhang</h5><p>November 23, 2020</p></div><div class=title><h1>Database System Lecture Note 3</h1></div><div class=post-content id=post-content><h1 id=chapter-10-storage-and-file-structure>Chapter 10 Storage and File Structure</h1><blockquote><p>对于应用程序和disk而言，中间会有data buffer作为数据交换的缓冲池，替换算法一般采用LRU算法，注意两种可控的参数，在实验中会用到：</p><ul><li>连接时长</li><li>buffer大小</li></ul></blockquote><p>逻辑结构：</p><ul><li>流式文件、基于记录文件、基于索引文件</li></ul><p>物理结构：</p><ul><li>以<strong>block</strong>为单位进行存储</li><li>contiguous</li><li>linked</li><li>indexed</li></ul><h2 id=105-file-organization>10.5 File Organization</h2><p>Each file is <strong>a sequence of records</strong>, and a relational table is <strong>a set of tuples</strong>.
A <strong>tuple</strong> is stored as a <strong>record</strong> in the DB file.</p><h3 id=1051-fixed-length-records>10.5.1 Fixed-Length Records</h3><ol><li><p>a block contains several records. Store record i starting from byte n * (i – 1), where n is the size of each record.
通过下标迅速定位record。
==all records are stored in a contiguous space==</p></li><li><p>Free lists
==all records are stored in a noncontiguous space==</p></li></ol><h3 id=1052-variable-length-records>10.5.2 Variable-Length Records</h3><ul><li>定长在block的head，变长在block的tail(length、offset等)</li><li>通过bitmap记录NULL值</li><li>&lt;offset, length> 的定长元组放在前面
<img src=/images/posts/DB/41.JPG alt></li></ul><ol start=2><li><strong>Slotted Page</strong><ul><li>一个slot对应一个或多个record</li><li>将变长record存放在page之中</li><li>Slotted Page header contains：<ul><li>number of record entries</li><li>end of free space in the block</li><li>location and size of each record
<img src=/images/posts/DB/42.JPG alt></li></ul></li></ul></li></ol><ul><li>delete and move</li><li>the pointer to $r_i$ should point to the entry for the record in header</li><li>需要更改三个地方</li></ul><h2 id=106-organization-of-records-in-files>10.6 Organization of Records in Files</h2><ol><li><strong>Heap</strong>
破坏逻辑顺序、但增删改很快。</li></ol><ul><li>Typically, there is a single file for a relation</li><li>一般以纪录的输入顺序为序，决定了文件中记录顺序</li><li>纪录的<strong>存储顺序与记录中的主键无关</strong>
E.g. 创建新关系表student(ID, name, total-credits)，但不在student上定义主键、候选键、各类索引，student被组织为heap file；通过insert，将记录/元组加到堆文件中。</li></ul><ol start=2><li><strong>Sequential</strong>
加入索引后，查询很快，增删改变慢。</li></ol><ul><li>Records are logically ordered by search-keys.</li><li>Chain together records by pointers.</li><li>Need to reorganize the file from time to time to restore sequential order.</li></ul><ol start=3><li><strong>Hashing</strong></li></ol><ul><li>The file records are stored in a number of buckets, the #bucket is the address of the record
<img src=/images/posts/DB/43.JPG alt></li></ul><ol><li><strong>Multitable Clustering File Organization</strong>
motivation: store related records on the same block to minimize I/O.</li></ol><ul><li>这种方式对于包含join操作的查询很有好处，方便natural join</li></ul><p><strong>重点！：</strong>
索引对于</p><ul><li>select有正作用</li><li>增删改有负作用(若没有用到索引，则无作用)</li><li>update需要分情况讨论，有些update操作既利用查询也用到改，这种正+负的作用最后往往是<strong>整体负效果</strong>。</li></ul><h2 id=107-data-dictionary-storage>10.7 Data Dictionary Storage</h2><p>The Data dictionary (also called system catalog) stores <strong>metadata</strong></p><ul><li>Information about relations<ul><li>names of relations</li><li>names, types and lengths of attributes of each relation</li><li>names and definitions of views</li><li>integrity constraints</li></ul></li><li>User and accounting information, including passwords</li><li>Statistical and descriptive data<ul><li>number of tuples in each relation</li></ul></li></ul><h2 id=108-buffer-management>10.8 Buffer Management</h2><p><img src=/images/posts/DB/51.jpg alt>
LRU算法替换</p><h2 id=appendix>Appendix</h2><h3 id=i>I.</h3><p>在一些小型关系数据库系统(dbase, Foxbase)
<img src=/images/posts/DB/44.JPG alt></p><ul><li>DB关系表中元组/数据行 到 DB文件中数据的逻辑地址（文件名，记录号）间的映射</li><li>DB文件记录号到外设上数据物理地址（记录所在的物理块号和具体地址）的映射</li></ul><h3 id=ii>II.</h3><p>在一些大型关系数据库系统(SQL Server, Oracle)
SQL Server利用<strong>索引分配映象IAM</strong>数据结构纪录每个数据库文件的页与该页所在物理盘区间的对应关系
<img src=/images/posts/DB/45.JPG alt></p><h1 id=chapter-11-indexing-and-hashing>Chapter 11 Indexing and Hashing</h1><h2 id=111-basic-concepts>11.1 Basic Concepts</h2><ol><li><p><strong>Search Key</strong>
attributes or a set of attributes used to look up the records in a file</p></li><li><p><strong>Indexing</strong>
mapping from search-key to storage locations of the file records
<img src=/images/posts/DB/46.JPG alt></p></li></ol><ul><li><strong>ordered indices</strong>: the index file is used to store the index entries in which the search key of the records and the address of the records are stored in sorted order</li><li><strong>hash indices</strong>: the “hash function” is used to map the the search key of the records to the address of the records. The records are stored in the “buckets”</li></ul><blockquote><p>索引支持等值、比较、范围查询</p></blockquote><h2 id=112-ordered-indices>11.2 Ordered Indices</h2><p>DB files with indexing mechanism include 2 parts:</p><ul><li><em><strong>indexed file</strong></em>: in which <strong>data records</strong> are stored;</li><li><em><strong>index file</strong></em>: in which <strong>index entries</strong> are included.</li></ul><blockquote><p>In <em><strong>index file</strong></em>, the index entries in the index file are stored in accordance with the order of the search key.</p></blockquote><h3 id=1121-primary-and-secondary-indices>11.2.1 Primary and Secondary Indices</h3><ol><li><strong>Primary Index (Clustering Index)</strong>
索引文件的搜索键所规定的顺序和被索引的顺序文件中的记录顺序一致。</li></ol><blockquote><p>聚集索引 vs 主索引
主索引：建立在主键的索引。
一张表只能一个聚集索引，因为数据文件根据索引项进行排序，只能有一种排序顺序。但可以建立多个非聚集索引。
主索引一定是聚集索引，聚集索引不一定是主索引。</p></blockquote><ol start=2><li><strong>Secondary Index (non-clustering Index)</strong>
Def: an index whose search key specifies an order different from the sequential order of the file.<br>Secondary indices have to be <strong>dense indices</strong>.</li></ol><ul><li><p><strong>Dense index</strong>:
the index record in the index file appears for every search-key value in the indexed file.
<img src=/images/posts/DB/47.JPG alt></p></li><li><p><strong>Sparse Index</strong>:
index file contains index entries for only some search-key values in the indexed file
<img src=/images/posts/DB/48.JPG alt></p></li></ul><ol start=3><li>Primary vs Secondary Indices
Sequential scan using <strong>primary index is efficient</strong>, but a sequential scan using a <strong>secondary index is expensive</strong>.</li></ol><h3 id=1122-multi-level-indices>11.2.2 Multi-level Indices</h3><p>Sometimes the index file may be very large, and cannot be entirely kept in memory.
<strong>Solution: treat primary index kept on disk as a sequential file and construct a sparse index on it.</strong></p><ul><li>outer index: a <strong>sparse index</strong> of primary index file</li><li>inner index: the primary index file</li></ul><p><img src=/images/posts/DB/49.JPG alt></p><h3 id=1125-indices-on-multiple-keys>11.2.5 Indices on multiple keys</h3><p><strong>Composite search keys</strong> are search keys containing more than one attribute.
E.g. (dept_name, salary)
E.g. create index Mutiple-index on takes(course_id, semester, year)</p><p>左前缀原则：
<img src=/images/posts/DB/50.JPG alt>
<img src=/images/posts/DB/52.JPG alt></p><blockquote><p>三个重要概念：
<strong>table scan</strong>: 表组织为堆文件，依次扫描判断满不满足where查询条件。
<strong>index seek</strong>: 用索引寻找(从上至下)，对应聚集索引的查找，效率较高。
<strong>index scan</strong>: 不用索引寻找，对应利用聚集索引建起来的树进行非聚集索引的查找，在索引顺序文件的叶子结点从左向右遍历。</p></blockquote><h2 id=113114-b树--b树>11.3/11.4 B+树 / B树</h2><p>此处考试不做要求，但对于数据库而言是很重要的组织索引的数据结构，一定要理解！</p><ol><li>Primary index
文件记录直接存储在叶节点</li><li>Secondary index
叶节点存储指向文件记录的指针</li></ol><h2 id=115116-hashing-index-files>11.5/11.6 Hashing Index Files</h2><ol><li>Hash Indices
Hashing can be used not only for file organization, but also for index-structure creation.<br>A <strong>hash index</strong> organizes the search keys, with their associated record pointers, into a hash file structure.
<img src=/images/posts/DB/53.JPG alt></li></ol><blockquote><p>Hash indices are always secondary indices</p></blockquote><ol start=2><li><p>Static hashing
hash function h cannot be modified, while being used</p></li><li><p>Dynamic hashing
hash function h to be modified dynamically</p></li></ol><h2 id=118-comparison-of-ordered-indexing-and-hashing>11.8 Comparison of Ordered Indexing and Hashing</h2><ol><li>等值查询：Hashing</li><li>范围查询：Ordered Indexing</li></ol><h2 id=1110--index-definition-and-usage-in-sql>11.10 Index Definition and Usage in SQL</h2><p><img src=/images/posts/DB/54.JPG alt></p><p><strong>ATTENTION</strong>
使用索引不一定真的能提高select查询速度。
对于非聚集索引的查找对比直接扫描数据文件，可能后者更快！</p></div><div class=btn-improve-page><a href=https://github.com/ztqakita/ztqakita.github.io/edit//content/posts/database-system/Database_System_3.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/operating-system/operating_system_concepts_7/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>Mass-Storage Structure & I/O System</span></a></div><div class="col-md-6 next-article"><a href=/posts/algorithms/algorithm_analysis-3/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Greedy & Back-track & Branch and Bound</span></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#105-file-organization>10.5 File Organization</a><ul><li><a href=#1051-fixed-length-records>10.5.1 Fixed-Length Records</a></li><li><a href=#1052-variable-length-records>10.5.2 Variable-Length Records</a></li></ul></li><li><a href=#106-organization-of-records-in-files>10.6 Organization of Records in Files</a></li><li><a href=#107-data-dictionary-storage>10.7 Data Dictionary Storage</a></li><li><a href=#108-buffer-management>10.8 Buffer Management</a></li><li><a href=#appendix>Appendix</a><ul><li><a href=#i>I.</a></li><li><a href=#ii>II.</a></li></ul></li></ul><ul><li><a href=#111-basic-concepts>11.1 Basic Concepts</a></li><li><a href=#112-ordered-indices>11.2 Ordered Indices</a><ul><li><a href=#1121-primary-and-secondary-indices>11.2.1 Primary and Secondary Indices</a></li><li><a href=#1122-multi-level-indices>11.2.2 Multi-level Indices</a></li><li><a href=#1125-indices-on-multiple-keys>11.2.5 Indices on multiple keys</a></li></ul></li><li><a href=#113114-b树--b树>11.3/11.4 B+树 / B树</a></li><li><a href=#115116-hashing-index-files>11.5/11.6 Hashing Index Files</a></li><li><a href=#118-comparison-of-ordered-indexing-and-hashing>11.8 Comparison of Ordered Indexing and Hashing</a></li><li><a href=#1110--index-definition-and-usage-in-sql>11.10 Index Definition and Usage in SQL</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=#achievements>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>ztqakita@163.com</span></li><li><span>Phone:</span> <span>(+86)18618180071</span></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form><div class=form-group><input type=email class=form-control id=exampleInputEmail1 aria-describedby=emailHelp placeholder="Enter email">
<small id=emailHelp class="form-text text-muted">We'll never share your email with anyone else.</small></div><button type=submit class="btn btn-info">Submit</button></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png>
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/js/jquery-3.4.1.min.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/navbar.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:!0,processEnvironments:!0,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var b=MathJax.Hub.getAllJax(),a;for(a=0;a<b.length;a+=1)b[a].SourceElement().parentNode.className+=' has-jax'}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>